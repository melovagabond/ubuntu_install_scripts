- name: set timezone
  timezone:
        name: "{{ timezone }}"
  become: true
  become_method: sudo

- name: update apt packages
  apt:
        name: "*"
        state: "latest"
        autoclean: true
        autoremvoe: true
        update_cache: true

- name: install apt packages
  list_of_packages: /files/install_apps.txt
  apt:
        name: "{{ list_of_packages }}"
        state: present
  register: apt_action
  retries: 100
  until: apt_action is success or ('Failed to lock apt for exclusive operation' not in apt_action.msg and '/var/lib/dpkg/lock' not in apt_action.msg)


- name: Install specified python requirements
  pip:
        requirements: /files/requirements.txt


- name: Install Oh My ZSH
  shell: sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
  args:
        executable: /bin/bash

- name: Install ZSH Auto Complete
  shell: wget https://raw.githubusercontent.com/zsh-users/zsh-autosuggestions/master/zsh-autosuggestions.zsh -P ~/.oh-my-zsh/custom/
  args:
        executable: /bin/bash

- name: Clone Git repos
  git_repos: /files/repos.txt
  git:
    repo: "{{ git_repos }}"
    dest: /opt

- name: Install Vagrant and Terraform (latest)
  shell: ./files/hashi.sh
  args:
        executable: /bin/bash